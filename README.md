# ParamPamMusic

## Описание

**ParamPamMusic** — это веб-приложение для управления музыкальной коллекцией и заказа аудиотреков. Система разработана с использованием **Spring Boot**, **PostgreSQL** и **Thymeleaf** и предоставляет пользователю возможность просматривать альбомы, аудиотреки, артистов, оставлять отзывы, добавлять треки в корзину и делать заказы. Приложение также поддерживает ролевую модель (админ и пользователь), позволяющую управлять доступом к различным разделам системы.

## Структура базы данных

Проект использует реляционную базу данных **PostgreSQL** с несколькими таблицами для управления пользователями, ролями, аудиотреками, альбомами, жанрами и заказами. Каждая таблица связана с другими через внешние ключи, что обеспечивает целостность данных. Полный SQL-запрос для создания базы данных можно найти в файле `SQL.sql`.

### Основные таблицы

- **user**: Хранит информацию о пользователях, включая логин, пароль, email, номер телефона, бонусные баллы и роль.
- **role**: Содержит роли пользователей (например, ADMIN, USER) для управления доступом к различным разделам.
- **album**: Содержит данные об альбомах.
- **artist** и **genre**: Таблицы для хранения информации об исполнителях и жанрах.
- **audio_track**: Хранит данные об аудиотреках, включая ссылку на альбом, исполнителя и жанр.
- **order** и **order_item**: Таблицы для хранения заказов и позиций заказов пользователей.
- **review**: Сохраняет отзывы пользователей к аудиотрекам, с возможностью оценивать от 1 до 5 звезд.

## Стек технологий

- **Backend**: Java, Spring Boot, Spring Data JPA, Spring Security
- **Frontend**: HTML, CSS, Thymeleaf
- **База данных**: PostgreSQL
- **Логирование**: Log4j2
- **Сборка проекта**: Maven

## Функциональные возможности

1. **Регистрация и авторизация пользователей**.
2. **Просмотр каталога** альбомов, исполнителей, треков и информации о каждом треке.
3. **Корзина и заказы**:
    - Добавление треков в корзину.
    - Просмотр и управление корзиной.
    - Создание заказа и подтверждение покупки.
4. **Отзывы**:
    - Оценка аудиотреков и добавление отзывов.
    - Просмотр отзывов с рейтингом.
5. **Ролевой доступ**:
    - Администратор может управлять пользователями, изменять бонусные баллы и просматривать статистику заказов.
6. **Локализация** на русском и английском языках.

## Установка

### 1. Предварительные требования

Для запуска приложения вам понадобятся:

- **Java 17+**
- **Maven**
- **PostgreSQL**

### 2. Склонируйте репозиторий

```
git clone https://github.com/ваш_пользователь/ParamPamMusic.git
cd ParamPamMusic
```

### 3. Настройка базы данных
Создайте базу данных PostgreSQL и пользователя.
Вставьте запросы для создания таблиц, указанных выше, или используйте файл с SQL-запросами в database/schema.sql.
В файле application.properties укажите параметры подключения к базе данных:
```
spring.datasource.url=jdbc:postgresql://localhost:5432/ParamPamMusicDB
spring.datasource.username=your_username
spring.datasource.password=your_password
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true
```
### 4. Запуск приложения
Скомпилируйте и запустите приложение с помощью Maven: 
```
mvn spring-boot:run
```
Приложение будет доступно по адресу http://localhost:8080.

## Использование

### Регистрация и авторизация
+ Перейдите на страницу '/register', чтобы создать нового пользователя.
+ После регистрации войдите на страницу '/login'.

### Основные разделы
+ Главная страница: содержит каталог аудиотреков и опцию фильтрации по жанру, альбому и исполнителю.
+ Корзина: доступна для авторизованных пользователей, позволяет добавлять аудиотреки, просматривать их и создавать заказ.
+ Отзывы: пользователи могут оставлять отзывы и оценки для аудиотреков, просматривать отзывы других пользователей.
+ Администратор:
   + Управление пользователями.
   + Изменение бонусных баллов.
   + Просмотр заказов и управление ими.
+ Пример основных маршрутов:
   + /register — регистрация нового пользователя.
   + /login — вход в систему.
   + /albums — просмотр альбомов.
   + /audio_tracks — просмотр аудиотреков.
   + /cart — просмотр корзины и оформление заказа.
   + admin — раздел администратора.

### Тестирование
Проект поддерживает юнит-тесты с использованием JUnit и MockMvc для тестирования контроллеров. Запуск тестов:

```
mvn test
```

### Локализация
Приложение поддерживает локализацию для английского и русского языков. Пользователи могут выбрать язык, и он будет сохраняться на протяжении всей сессии.

### Логирование
Конфигурация логирования с помощью `Log4j2` позволяет создавать новый лог-файл при каждом запуске приложения. Настройки логирования находятся в файле `log4j2.xml`.

### Примеры SQL-запросов
#### Пример вставки данных
```
// Пример создания пользователя
INSERT INTO "user" (login, password, email, tel_number, role_id)
VALUES ('user1', 'password1', 'user1@example.com', '+123456789', 1);

// Пример создания аудиотрека
INSERT INTO audio_track (title, artist_id, genre_id, album_id, price)
VALUES ('Track 1', 1, 1, 1, 9.99);
```
### Авторы
Паляница Кирилл — разработка, настройка базы данных и реализация основных функций.

### Заключение
ParamPamMusic — это полнофункциональное приложение для управления музыкальной коллекцией и заказами аудиотреков. Система реализует MVC-архитектуру, используя Spring Boot для backend и Thymeleaf для frontend. Проект может быть расширен с добавлением новых функций и улучшенной логикой безопасности.
